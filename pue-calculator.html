<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cooling Economizer Mode PUE Calculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <style>
        /* --- 全局設定 --- */
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; background-color: #f4f7f6; color: #444; }
        
        /* 頂部綠色標題列 */
        header { background-color: #3dcd58; color: white; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; height: 40px; }
        .brand { font-weight: bold; font-size: 16px; display: flex; align-items: center; gap: 10px; }
        .title { font-size: 18px; font-weight: 500; text-transform: uppercase; }

        /* 主容器 */
        .container { max-width: 1200px; margin: 20px auto; padding: 0 15px; }

        /* --- 上半部：輸入區 (Inputs) --- */
        .inputs-section { display: flex; gap: 20px; margin-bottom: 20px; }
        
        /* 通用面板樣式 */
        .panel { background: white; border: 1px solid #ddd; flex: 1; padding-bottom: 10px; }
        .panel-header { background: #999; color: white; padding: 8px 15px; font-weight: bold; font-size: 14px; display: flex; justify-content: space-between; }

        .panel-body { padding: 15px; display: grid; gap: 12px; }

        /* 左側輸入區 (Location) */
        .location-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; margin-bottom: 10px; }
        .location-grid select { padding: 4px; border: 1px solid #ccc; border-radius: 3px; background: linear-gradient(to bottom, #f9f9f9, #e0e0e0); font-weight: bold; color: #555; }
        
        .data-row { display: flex; align-items: center; justify-content: space-between; font-size: 13px; }
        .data-row label { flex: 2; color: #666; }
        .data-row .value { flex: 1; text-align: right; font-weight: bold; margin-right: 10px; }
        .override-box { width: 16px; height: 16px; border: 1px solid #999; background: #eee; }

        /* 右側輸入區 (Characteristics) */
        .slider-row { display: flex; align-items: center; justify-content: space-between; font-size: 13px; }
        .slider-row label { flex: 1.5; color: #666; }
        .slider-wrapper { flex: 2; display: flex; align-items: center; gap: 10px; }
        
        input[type="range"] {
            flex: 1; height: 6px; background: #ccc; border-radius: 3px; outline: none; -webkit-appearance: none; appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 18px; height: 18px; background: #3dcd58; border-radius: 50%; border: 2px solid white; cursor: pointer; box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        .slider-val { width: 60px; text-align: right; font-weight: bold; }

        .gray-btn { background: linear-gradient(to bottom, #eee, #ccc); border: 1px solid #999; padding: 3px 10px; border-radius: 3px; font-size: 12px; color: #555; cursor: pointer; text-align: center; width: 100%; }

        /* --- 下半部：結果區 (Results) --- */
        .results-section { background: white; border: 1px solid #ddd; }
        .results-header { background: #999; color: white; padding: 8px 15px; font-weight: bold; font-size: 14px; display: flex; justify-content: space-between; }
        
        .results-table { width: 100%; border-collapse: collapse; font-size: 13px; }
        .results-table th { text-align: right; color: #666; font-weight: normal; padding: 10px 20px; border-bottom: 1px solid #eee; }
        .results-table td { padding: 12px 20px; border-bottom: 1px solid #f0f0f0; vertical-align: middle; }
        
        .arch-name { font-weight: bold; color: #555; text-transform: uppercase; width: 15%; }
        .arch-desc { color: #777; font-size: 12px; width: 35%; }
        
        /* PUE 條狀圖 */
        .bar-container { width: 200px; height: 14px; background: #eee; border-radius: 7px; overflow: hidden; border: 1px solid #ddd; box-shadow: inset 0 1px 2px rgba(0,0,0,0.1); display: inline-block; vertical-align: middle; }
        .bar-fill { height: 100%; background: linear-gradient(to right, #3dcd58, #2bb673); width: 0%; transition: width 0.5s ease; }
        
        .val-col { text-align: right; font-weight: bold; color: #444; width: 10%; }

        /* 左側綠色裝飾條 (模仿原圖左側的 $ 和時鐘 icon) */
        .side-icons {
            position: fixed; left: 0; top: 150px; width: 40px; display: flex; flex-direction: column; gap: 5px;
        }
        .icon-tab { background: #3dcd58; color: white; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-size: 20px; border-top-right-radius: 5px; border-bottom-right-radius: 5px; box-shadow: 2px 2px 5px rgba(0,0,0,0.1); }

    </style>
</head>
<body>

    <header>
        <div class="brand">
            Life Is On | Schneider Electric
        </div>
        <div class="title">Cooling Economizer Mode PUE Calculator</div>
        <div><i class="fas fa-question-circle"></i></div>
    </header>

    <div class="side-icons">
        <div class="icon-tab"><i class="fas fa-dollar-sign"></i></div>
        <div class="icon-tab"><i class="fas fa-clock"></i></div>
    </div>

    <div class="container">
        <div class="inputs-section">
            
            <div class="panel">
                <div class="panel-header">Data Center Location <i class="fas fa-question-circle"></i></div>
                <div class="panel-body">
                    <div class="location-grid">
                        <select><option>United States</option></select>
                        <select id="state" onchange="updateLocationData()">
                            <option value="MA">Massachusetts</option>
                            <option value="CA">California</option>
                            <option value="TX">Texas</option>
                        </select>
                        <select id="city" onchange="updateLocationData()">
                            <option value="Boston">Boston</option>
                            <option value="LA">Los Angeles</option>
                            <option value="Dallas">Dallas</option>
                        </select>
                    </div>

                    <div class="data-row" style="margin-top:10px;">
                        <label>Currency</label>
                        <span class="value">$</span>
                        <div class="override-box"></div>
                    </div>
                    <div class="data-row">
                        <label>Electricity Cost per kWh</label>
                        <span class="value" id="disp_elec">0.16</span>
                        <div class="override-box"></div>
                    </div>
                    <div class="data-row">
                        <label>CO2 Emissions (kg/kWh)</label>
                        <span class="value" id="disp_co2">0.579</span>
                        <div class="override-box"></div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">Power & Environmental Characteristics <i class="fas fa-question-circle"></i></div>
                <div class="panel-body">
                    <div class="slider-row">
                        <label>Data Center IT Capacity</label>
                        <div class="slider-wrapper">
                            <div class="gray-btn">1000 kW</div>
                        </div>
                    </div>

                    <div class="slider-row">
                        <label>Data Center IT Load</label>
                        <div class="slider-wrapper">
                            <input type="range" id="load" min="10" max="100" value="50" oninput="calculate()">
                            <span class="slider-val" id="val_load">50%</span>
                        </div>
                    </div>

                    <div class="slider-row">
                        <label>IT Operating Environment</label>
                        <div class="slider-wrapper">
                            <div class="gray-btn">User defined temperature</div>
                        </div>
                    </div>

                    <div class="slider-row">
                        <label>IT Inlet Temperature</label>
                        <div class="slider-wrapper">
                            <input type="range" id="temp" min="60" max="85" value="70" oninput="calculate()">
                            <span class="slider-val" id="val_temp">70 °F</span>
                        </div>
                    </div>

                    <div class="slider-row">
                        <label>Power & Lighting</label>
                        <div class="slider-wrapper">
                            <div class="gray-btn">No power or lighting losses</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="results-section">
            <div class="results-header">PUE, Annual Energy Cost, Annual Carbon Emissions <i class="fas fa-question-circle"></i></div>
            
            <table class="results-table">
                <thead>
                    <tr>
                        <th></th>
                        <th></th>
                        <th style="text-align:left; padding-left:0;">Cooling PUE</th>
                        <th>Cost</th>
                        <th>CO2</th>
                    </tr>
                </thead>
                <tbody id="resultsBody">
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        // --- 1. 定義基礎數據 (模擬後端資料庫) ---
        const locationData = {
            'Boston': { rate: 0.16, co2: 0.579 },
            'LA':     { rate: 0.22, co2: 0.240 }, // 加州電貴但乾淨
            'Dallas': { rate: 0.11, co2: 0.450 }  // 德州電便宜
        };

        // 定義四種冷卻架構的「基礎 PUE」 (Base PUE)
        // 假設這是在 50% Load, 70F 溫度的基準值
        const architectures = [
            { 
                name: "BASELINE", 
                desc: "Chiller w/tower & perimeter CRAH w/o econ", 
                basePue: 1.78 
            },
            { 
                name: "CHILLED WATER", 
                desc: "Chiller w/tower & PFHX & perimeter CRAH", 
                basePue: 1.52 
            },
            { 
                name: "GLYCOL-COOLED", 
                desc: "Perimeter CRAC w/dry cooler", 
                basePue: 1.52 // 修正：圖片中 Glycol 跟 Chilled Water 差不多，設一樣
            },
            { 
                name: "AIR-COOLED", 
                desc: "Direct air w/evap assist", 
                basePue: 1.17 
            }
        ];

        // --- 2. 連動邏輯 ---
        function updateLocationData() {
            const city = document.getElementById('city').value;
            const data = locationData[city];
            
            // 更新畫面上顯示的電費與碳係數
            document.getElementById('disp_elec').innerText = data.rate.toFixed(2);
            document.getElementById('disp_co2').innerText = data.co2.toFixed(3);
            
            calculate(); // 數值變了，重算
        }

        // --- 3. 核心運算 (Physics Simulation) ---
        function calculate() {
            // 讀取輸入
            const loadPct = parseInt(document.getElementById('load').value);
            const tempF = parseInt(document.getElementById('temp').value);
            
            // 讀取當前地點係數
            const rate = parseFloat(document.getElementById('disp_elec').innerText);
            const co2Factor = parseFloat(document.getElementById('disp_co2').innerText);
            const capacity = 1000; // kW (固定)

            // 更新 Slider 文字
            document.getElementById('val_load').innerText = loadPct + "%";
            document.getElementById('val_temp').innerText = tempF + " °F";

            // --- 模擬 PUE 變化曲線 ---
            // 規則 1: 負載越低，PUE 越高 (因為固定損耗佔比變大)
            // 簡單模擬：每低於 50% 10%，PUE 增加 0.05
            let loadFactor = 1;
            if(loadPct < 50) loadFactor += (50 - loadPct) * 0.002;
            if(loadPct > 50) loadFactor -= (loadPct - 50) * 0.001; // 高負載效率稍微好一點

            // 規則 2: 入口溫度越高，PUE 越低 (因為冷卻需求降低)
            // 簡單模擬：溫度每高 1度，PUE 減少 0.005
            let tempFactor = 1 - (tempF - 70) * 0.005;

            // 準備生成 HTML
            let html = "";
            let maxPue = 2.0; // 用來計算長條圖比例

            architectures.forEach(arch => {
                // 計算最終 PUE
                let finalPue = arch.basePue * loadFactor * tempFactor;
                if(finalPue < 1.05) finalPue = 1.05; // PUE 不可能小於 1.05

                // 計算能耗與成本
                // 總能耗 (kWh) = IT負載(kW) * PUE * 8760小時
                let itLoadKw = capacity * (loadPct / 100);
                let totalEnergy = itLoadKw * finalPue * 8760;
                
                let annualCost = totalEnergy * rate;
                let annualCo2 = (totalEnergy * co2Factor) / 1000; // 換算成頓 (tonnes)

                // 格式化數字
                let costStr = "";
                if(annualCost > 1000000) {
                    costStr = "$ " + (annualCost/1000000).toFixed(1) + "M";
                } else {
                    costStr = "$ " + (annualCost/1000).toFixed(1) + "k";
                }
                
                let co2Str = Math.round(annualCo2).toLocaleString() + " t";

                // 計算長條圖寬度 (相對於 maxPue)
                let barWidth = (finalPue / maxPue) * 100;
                if(barWidth > 100) barWidth = 100;

                // 生成表格列
                html += `
                    <tr>
                        <td class="arch-name">${arch.name}</td>
                        <td class="arch-desc">${arch.desc}</td>
                        <td>
                            <div class="bar-container">
                                <div class="bar-fill" style="width: ${barWidth}%"></div>
                            </div>
                        </td>
                        <td class="val-col">${finalPue.toFixed(2)}</td>
                        <td class="val-col">${costStr}</td>
                        <td class="val-col">${co2Str}</td>
                    </tr>
                `;
            });

            document.getElementById('resultsBody').innerHTML = html;
        }

        // 初始化
        updateLocationData();

    </script>
</body>
</html>